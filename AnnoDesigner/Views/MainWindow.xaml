<ui:FluentWindow
    x:Class="AnnoDesigner.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:converters="clr-namespace:AnnoDesigner.Converters"
    xmlns:coreConverters="clr-namespace:AnnoDesigner.Core.Converters;assembly=AnnoDesigner.Core"
    xmlns:coreModels="clr-namespace:AnnoDesigner.Core.Models;assembly=AnnoDesigner.Core"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:l="clr-namespace:AnnoDesigner.Localization"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:modelPresetsTree="clr-namespace:AnnoDesigner.Models.PresetsTree"
    xmlns:my="clr-namespace:AnnoDesigner"
    xmlns:canvasV2="clr-namespace:AnnoDesigner.CanvasV2"
    xmlns:myBehaviors="clr-namespace:AnnoDesigner.Behaviors"
    xmlns:properties="clr-namespace:AnnoDesigner.Properties"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:viewModel="clr-namespace:AnnoDesigner.ViewModels"
    xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
    xmlns:xcad="http://schemas.xceed.com/wpf/xaml/avalondock"
    xmlns:wpfui="clr-namespace:AvalonDock.Themes.WPFUI;assembly=AvalonDock.Themes.WPFUI"
    x:Name="mainWindow"
    Width="{Binding MainWindowWidth, Mode=TwoWay}"
    Height="{Binding MainWindowHeight, Mode=TwoWay}"
    MinWidth="640"
    MinHeight="480"
    d:DataContext="{d:DesignInstance Type=viewModel:MainViewModel,
                                     IsDesignTimeCreatable=False}"
    d:DesignHeight="1080"
    d:DesignWidth="1290"
    ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
    ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    Closing="WindowClosing"
    ExtendsContentIntoTitleBar="True"
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    Left="{Binding MainWindowLeft, Mode=TwoWay}"
    Loaded="WindowLoaded"
    Top="{Binding MainWindowTop, Mode=TwoWay}"
    WindowBackdropType="Mica"
    WindowCornerPreference="Round"
    WindowStartupLocation="CenterScreen"
    WindowState="{Binding MainWindowWindowState, Mode=TwoWay}"
    mc:Ignorable="d">
    <Window.Resources>
        <coreConverters:UnsavedChangesConverter x:Key="converterUnsavedChanges"/>
        <coreConverters:BoolToVisibilityConverter
            x:Key="converterBoolToVisibility"
            FalseValue="Hidden"
            TrueValue="Visible"/>
        <coreConverters:BoolToVisibilityConverter
            x:Key="converterBoolToVisibilityCollapsed"
            FalseValue="Collapsed"
            TrueValue="Visible"/>
        <xctk:ColorToSolidColorBrushConverter x:Key="converterColorToSolidColorBrush"/>
        <HierarchicalDataTemplate DataType="{x:Type coreModels:AnnoObject}">
            <TextBlock Text="{Binding Label}"/>
        </HierarchicalDataTemplate>

        <Style x:Key="CardStyle"
               TargetType="Border">
            <Setter Property="Padding"
                    Value="0,16,0,16"/>
            <Setter Property="BorderThickness"
                    Value="0,0,0,1"/>
            <Setter Property="BorderBrush"
                    Value="{DynamicResource ExpanderHeaderBorderBrush}"/>
        </Style>

    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <ui:TitleBar Grid.Row="0"
                     d:Title="Untitled*">
            <ui:TitleBar.Icon>
                <ui:ImageIcon Source="/icon_v2.ico"/>
            </ui:TitleBar.Icon>
            <!--<ui:TitleBar.Title>
                <MultiBinding Converter="{StaticResource converterUnsavedChanges}">
                    <Binding Path="MainWindowTitle"/>
                    <Binding Path="AnnoCanvas.UndoManager.IsDirty"/>
                </MultiBinding>
            </ui:TitleBar.Title>-->


            <ui:TitleBar.Header>

                <Menu Name="Menu"
                      Grid.ColumnSpan="3"
                      VerticalAlignment="Top">
                    <Menu.Resources>
                        <Style TargetType="{x:Type MenuItem}">
                            <Style.Triggers>
                                <Trigger Property="IsEnabled"
                                         Value="False">
                                    <Setter Property="Foreground"
                                            Value="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Menu.Resources>

                    <!-- FILE -->
                    <ui:MenuItem Header="{l:Localize File}"
                                 TabIndex="10">
                        <ui:MenuItem Command="ApplicationCommands.New"
                                     CommandTarget="{Binding ElementName=annoCanvas}"
                                     Header="{l:Localize NewCanvas}"/>
                        <ui:MenuItem Command="ApplicationCommands.Open"
                                     CommandTarget="{Binding ElementName=annoCanvas}"
                                     Header="{l:Localize Open}"/>
                        <ui:MenuItem Command="ApplicationCommands.Save"
                                     CommandTarget="{Binding ElementName=annoCanvas}"
                                     Header="{l:Localize Save}"/>
                        <ui:MenuItem Command="ApplicationCommands.SaveAs"
                                     CommandTarget="{Binding ElementName=annoCanvas}"
                                     Header="{l:Localize SaveAs}"/>
                        <Separator/>
                        <ui:MenuItem Header="{l:Localize RecentFiles}"
                                     IsEnabled="{Binding HasRecentFiles}"
                                     ItemsSource="{Binding RecentFiles}">
                            <ui:MenuItem.ItemContainerStyle>
                                <Style TargetType="MenuItem">
                                    <Setter Property="HeaderTemplate">
                                        <Setter.Value>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Path, Mode=OneTime}"/>
                                            </DataTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Setter Property="Command"
                                            Value="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Window}}, Path=DataContext.OpenRecentFileCommand}"/>
                                    <Setter Property="CommandParameter"
                                            Value="{Binding}"/>
                                </Style>
                            </ui:MenuItem.ItemContainerStyle>
                        </ui:MenuItem>
                        <Separator/>
                        <ui:MenuItem Command="{Binding CloseWindowCommand}"
                                     CommandParameter="{Binding ElementName=mainWindow}"
                                     Header="{l:Localize Exit}"/>
                    </ui:MenuItem>
                    <!-- EDIT -->
                    <ui:MenuItem Header="{l:Localize Edit}"
                                 TabIndex="11">
                        <ui:MenuItem Command="ApplicationCommands.Undo"
                                     Header="{l:Localize Undo}"/>
                        <ui:MenuItem Command="ApplicationCommands.Redo"
                                     Header="{l:Localize Redo}"/>
                        <Separator/>
                        <ui:MenuItem Command="ApplicationCommands.Copy"
                                     Header="{l:Localize Copy}"/>
                        <ui:MenuItem Command="ApplicationCommands.Paste"
                                     Header="{l:Localize Paste}"/>
                        <ui:MenuItem Command="ApplicationCommands.Delete"
                                     Header="{l:Localize Delete}"/>
                    </ui:MenuItem>

                    <!-- VIEW -->
                    <ui:MenuItem Header="{l:Localize View}"
                                 TabIndex="12">
                        <ui:MenuItem Header="{l:Localize ShowGrid}"
                                     IsCheckable="True"
                                     IsChecked="{Binding CanvasShowGrid}"/>
                        <ui:MenuItem Header="{l:Localize ShowLabels}"
                                     IsCheckable="True"
                                     IsChecked="{Binding CanvasShowLabels}"/>
                        <ui:MenuItem Header="{l:Localize ShowIcons}"
                                     IsCheckable="True"
                                     IsChecked="{Binding CanvasShowIcons}"/>
                        <Separator/>
                        <ui:MenuItem Header="{l:Localize ShowInfluences}"
                                     IsCheckable="True"
                                     IsChecked="{Binding CanvasShowInfluences}"/>
                        <ui:MenuItem Header="{l:Localize ShowTrueInfluenceRange}"
                                     IsCheckable="True"
                                     IsChecked="{Binding CanvasShowTrueInfluenceRange}"/>
                        <ui:MenuItem Header="{l:Localize ShowHarborBlockedArea}"
                                     IsCheckable="True"
                                     IsChecked="{Binding CanvasShowHarborBlockedArea}"/>
                        <ui:MenuItem Header="{l:Localize ShowPanorama}"
                                     IsCheckable="True"
                                     IsChecked="{Binding CanvasShowPanorama}"/>
                        <Separator/>
                        <ui:MenuItem Command="{Binding CanvasResetZoomCommand}"
                                     Header="{l:Localize ResetZoom}"/>
                    </ui:MenuItem>

                    <!-- LAYOUT / TOOLS -->
                    <ui:MenuItem Header="{l:Localize Layout}"
                                 TabIndex="13">
                        <ui:MenuItem Command="{Binding MergeRoadsCommand}"
                                     Header="{l:Localize MergeRoads}"/>
                        <ui:MenuItem Command="{Binding CanvasNormalizeCommand}"
                                     Header="{l:Localize NormalizeLayout}"/>
                        <Separator/>
                        <ui:MenuItem IsEnabled="False"
                                     Command="{Binding OptimizeLayoutCommand}"
                                     Header="{l:Localize OptimizeLayout}"/>
                        <ui:MenuItem IsEnabled="False"
                                     Command="{Binding ValidateLayoutCommand}"
                                     Header="{l:Localize ValidateLayout}"/>
                        <ui:MenuItem IsEnabled="False"
                                     Command="{Binding AutoAlignCommand}"
                                     Header="{l:Localize AutoAlign}"/>
                    </ui:MenuItem>

                    <!-- EXPORT -->
                    <ui:MenuItem Header="{l:Localize ImportExport}"
                                 TabIndex="11">
                        <!-- IMPORT -->
                        <ui:MenuItem Header="{l:Localize Import}">
                            <ui:MenuItem Command="{Binding LoadLayoutFromJsonCommand}"
                                         Header="{l:Localize FromJSON}"/>
                            <!-- Future -->
                            <ui:MenuItem IsEnabled="False"
                                         Command="{Binding ImportBlueprintCommand}"
                                         Header="{l:Localize FromBlueprint}"/>
                            <ui:MenuItem IsEnabled="False"
                                         Command="{Binding ImportFromClipboardCommand}"
                                         Header="{l:Localize FromClipboard}"/>

                        </ui:MenuItem>

                        <!-- EXPORT -->
                        <ui:MenuItem Header="{l:Localize Export}">
                            <ui:MenuItem Command="{Binding ExportImageCommand}"
                                         Header="{l:Localize AsImage}"/>
                            <ui:MenuItem Command="{Binding CopyLayoutToClipboardCommand}"
                                         Header="{l:Localize ToClipboard}"/>
                            <ui:MenuItem Command="{Binding ExportToJSONCommand}"
                                         Header="{l:Localize AsJSON}"/>
                            <ui:MenuItem Command="{Binding ExportToBlueprintCommand}"
                                         Header="{l:Localize AsBlueprint}"/>
                            <Separator/>
                            <ui:MenuItem Header="{l:Localize ExportSettings}"
                                         IsEnabled="False"/>
                            <ui:MenuItem Header="{l:Localize UseCurrentZoomOnExportedImage}"
                                         IsCheckable="True"
                                         IsChecked="{Binding UseCurrentZoomOnExportedImageValue}"/>
                            <ui:MenuItem Header="{l:Localize RenderSelectionHighlightsOnExportedImage}"
                                         IsCheckable="True"
                                         IsChecked="{Binding RenderSelectionHighlightsOnExportedImageValue}"/>
                            <ui:MenuItem Header="{l:Localize RenderVersionOnExportedImage}"
                                         IsCheckable="True"
                                         IsChecked="{Binding RenderVersionOnExportedImageValue}"/>
                        </ui:MenuItem>
                    </ui:MenuItem>


                    <!-- STATISTICS -->
                    <ui:MenuItem Header="{l:Localize Statistics}"
                                 TabIndex="15">
                        <ui:MenuItem Command="{Binding ShowStatisticsCommand}"
                                     Header="{l:Localize ShowStats}"
                                     IsCheckable="True"
                                     IsChecked="{Binding StatisticsViewModel.IsVisible}"/>
                        <ui:MenuItem Command="{Binding ShowStatisticsBuildingCountCommand}"
                                     Header="{l:Localize BuildingCount}"
                                     IsCheckable="True"
                                     IsChecked="{Binding StatisticsViewModel.ShowStatisticsBuildingCount}"
                                     IsEnabled="{Binding StatisticsViewModel.IsVisible}"/>
                        <Separator/>
                        <ui:MenuItem Command="{Binding ExportStatisticsCommand}"
                                     Header="{l:Localize ExportStats}"/>
                        <!-- New -->
                    </ui:MenuItem>

                    <!-- EXTENSIONS -->
                    <ui:MenuItem Header="{l:Localize Extensions}"
                                 TabIndex="16">
                        <ui:MenuItem Command="{Binding RegisterExtensionCommand}"
                                     Header="{l:Localize RegisterFileExtension}"/>
                        <ui:MenuItem Command="{Binding UnregisterExtensionCommand}"
                                     Header="{l:Localize UnregisterFileExtension}"/>
                        <Separator/>
                        <ui:MenuItem Command="{Binding ManagePluginsCommand}"
                                     Header="{l:Localize ManagePlugins}"/>
                        <!-- New -->
                        <ui:MenuItem Command="{Binding RefreshPluginsCommand}"
                                     Header="{l:Localize ReloadPlugins}"/>
                        <!-- New -->
                    </ui:MenuItem>

                    <!-- SETTINGS -->
                    <ui:MenuItem Header="{l:Localize Settings}"
                                 TabIndex="17">
                        <ui:MenuItem Command="{Binding ShowPreferencesWindowCommand}"
                                     Header="{l:Localize Preferences}"/>
                        <Separator/>
                        <ui:MenuItem Header="{l:Localize Language}"
                                     ItemsSource="{Binding Languages}">
                            <ui:MenuItem.Resources>
                                <Image x:Key="flagImage"
                                       Height="22"
                                       x:Shared="False"
                                       Source="{Binding FlagPath}"/>
                            </ui:MenuItem.Resources>
                            <ui:MenuItem.ItemContainerStyle>
                                <Style TargetType="MenuItem">
                                    <Setter Property="Icon"
                                            Value="{StaticResource flagImage}"/>
                                    <Setter Property="Header"
                                            Value="{Binding Name}"/>
                                    <Setter Property="IsCheckable"
                                            Value="True"/>
                                    <Setter Property="IsChecked"
                                            Value="{Binding IsSelected, Mode=TwoWay}"/>
                                    <Setter Property="Command"
                                            Value="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Window}}, Path=DataContext.LanguageSelectedCommand}"/>
                                    <Setter Property="CommandParameter"
                                            Value="{Binding}"/>
                                </Style>
                            </ui:MenuItem.ItemContainerStyle>
                        </ui:MenuItem>
                    </ui:MenuItem>

                    <!-- HELP -->
                    <ui:MenuItem Header="{l:Localize Help}"
                                 TabIndex="18">
                        <ui:MenuItem Command="{Binding ShowWelcomeWindowCommand}"
                                     Header="{l:Localize WelcomeGuide}"/>
                        <ui:MenuItem Command="{Binding OpenProjectHomepageCommand}"
                                     Header="{l:Localize ProjectHomepage}"/>
                        <ui:MenuItem Command="{Binding ShowLicensesWindowCommand}"
                                     Header="{l:Localize ViewLicenses}"/>
                        <Separator/>
                        <ui:MenuItem Command="{Binding ShowAboutWindowCommand}"
                                     Header="{l:Localize AboutAnnoDesigner}"/>
                        <ui:MenuItem Command="{Binding CheckForUpdatesCommand}"
                                     Header="{l:Localize CheckForUpdates}"/>
                        <!-- New -->
                    </ui:MenuItem>
                </Menu>


            </ui:TitleBar.Header>


            <ui:TitleBar.TrailingContent>
                <Button>
                    <ui:FontIcon Glyph="&#xE711;"
                                 FontSize="16"/>
                </Button>
            </ui:TitleBar.TrailingContent>
        </ui:TitleBar>
        <xctk:BusyIndicator x:Name="busyIndicator"
                            Grid.Row="1">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition
                        MinWidth="100"/>
                </Grid.ColumnDefinitions>

                <DockingManager x:Name="dockManager"
                                Grid.Row="1"
                                Grid.Column="0">

                    <DockingManager.Theme>
                        <wpfui:WPFUITheme/>
                    </DockingManager.Theme>

                    <LayoutRoot>
                        <LayoutPanel Orientation="Horizontal">
                            <!-- Left: Presets as an anchorable pane -->
                            <LayoutAnchorablePane DockWidth="300">
                                <LayoutAnchorable Title="{l:Localize PresetsSectionHeader}"
                                                  CanClose="False">
                                    <DockPanel Margin="8"
                                               LastChildFill="True">
                                        <StackPanel DockPanel.Dock="Top"
                                                    Margin="0,0,0,6">
                                            <TextBlock Text="{Binding PresetsSectionHeader}"
                                                       FontWeight="SemiBold"
                                                       FontSize="14"
                                                       Margin="0,0,0,4"/>
                                            <!-- Inline search + version filters at top of presets list -->
                                            <StackPanel Margin="0,0,0,4">
                                                <ui:AutoSuggestBox
                                                    x:Name="TextBoxSearchPresets"
                                                    VerticalContentAlignment="Center"
                                                    KeyUp="TextBoxSearchPresetsKeyUp"
                                                    PlaceholderText="Search"
                                                    Text="{Binding PresetsTreeSearchViewModel.SearchText, UpdateSourceTrigger=PropertyChanged}"
                                                    ToolTip="{l:Localize SearchToolTip}">
                                                    <b:Interaction.Triggers>
                                                        <b:EventTrigger EventName="GotFocus">
                                                            <b:InvokeCommandAction Command="{Binding PresetsTreeSearchViewModel.GotFocusCommand}"/>
                                                        </b:EventTrigger>
                                                        <b:EventTrigger EventName="LostFocus">
                                                            <b:InvokeCommandAction Command="{Binding PresetsTreeSearchViewModel.LostFocusCommand}"/>
                                                        </b:EventTrigger>
                                                    </b:Interaction.Triggers>
                                                    <ui:AutoSuggestBox.InputBindings>
                                                        <KeyBinding
                                                            Key="Esc"
                                                            Command="{Binding PresetsTreeSearchViewModel.ClearSearchTextCommand}"
                                                            CommandParameter="{Binding ElementName=TextBoxSearchPresets}"/>
                                                    </ui:AutoSuggestBox.InputBindings>
                                                </ui:AutoSuggestBox>
                                                <StackPanel Orientation="Horizontal"
                                                            Margin="0,6,0,2">
                                                    <TextBlock Text="{l:Localize GameVersions}"
                                                               VerticalAlignment="Center"
                                                               Margin="0,0,8,0"/>
                                                    <Button Padding="4,2"
                                                            MinWidth="60"
                                                            Command="{Binding PresetsTreeSearchViewModel.SelectAllGameVersionsCommand}">
                                                        <TextBlock Text="{l:Localize SelectAll}"/>
                                                    </Button>
                                                    <Button Padding="4,2"
                                                            MinWidth="60"
                                                            Margin="4,0,0,0"
                                                            Command="{Binding PresetsTreeSearchViewModel.ClearAllGameVersionsCommand}">
                                                        <TextBlock Text="{l:Localize Clear}"/>
                                                    </Button>
                                                </StackPanel>
                                                <ScrollViewer MaxHeight="90"
                                                              VerticalScrollBarVisibility="Auto">
                                                    <ItemsControl ItemsSource="{Binding PresetsTreeSearchViewModel.GameVersionFilters}">
                                                        <ItemsControl.ItemsPanel>
                                                            <ItemsPanelTemplate>
                                                                <WrapPanel/>
                                                            </ItemsPanelTemplate>
                                                        </ItemsControl.ItemsPanel>
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <CheckBox Content="{Binding Name}"
                                                                          IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                                                          Margin="4,2"/>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>
                                                </ScrollViewer>
                                            </StackPanel>
                                        </StackPanel>
                                        <TreeView
                                            x:Name="PresetsTree"
                                            VerticalContentAlignment="Stretch"
                                            ItemsSource="{Binding PresetsTreeViewModel.FilteredItems}">
                                            <TreeView.Resources>
                                                <HierarchicalDataTemplate DataType="{x:Type modelPresetsTree:GameHeaderTreeItem}"
                                                                          ItemsSource="{Binding Children}">
                                                    <TextBlock FontWeight="SemiBold"
                                                               Text="{Binding Header}"/>
                                                </HierarchicalDataTemplate>
                                                <HierarchicalDataTemplate DataType="{x:Type modelPresetsTree:GenericTreeItem}"
                                                                          ItemsSource="{Binding Children}">
                                                    <TextBlock Text="{Binding Header}"/>
                                                </HierarchicalDataTemplate>
                                            </TreeView.Resources>
                                            <TreeView.InputBindings>
                                                <KeyBinding
                                                    Key="Return"
                                                    Command="{Binding PresetsTreeViewModel.ReturnKeyPressedCommand}"
                                                    CommandParameter="{Binding SelectedItem, ElementName=PresetsTree}"/>
                                            </TreeView.InputBindings>
                                            <b:Interaction.Triggers>
                                                <b:EventTrigger EventName="MouseDoubleClick">
                                                    <b:InvokeCommandAction Command="{Binding PresetsTreeViewModel.DoubleClickCommand}"
                                                                           CommandParameter="{Binding SelectedItem, ElementName=PresetsTree}"/>
                                                </b:EventTrigger>
                                            </b:Interaction.Triggers>
                                        </TreeView>
                                    </DockPanel>
                                </LayoutAnchorable>

                                <LayoutAnchorable Title="{l:Localize Statistics}"
                                                  CanClose="False">
                                    <my:StatisticsView
                                        x:Name="statisticsView"
                                        DataContext="{Binding StatisticsViewModel}"
                                        Margin="1,0,0,0"/>
                                </LayoutAnchorable>
                            </LayoutAnchorablePane>

                            <!-- Center: canvas + buildings as a document -->
                            <LayoutDocumentPane>
                                <LayoutDocument Title="Canvas"
                                                IsActive="True"
                                                CanClose="False">

                                    <ScrollViewer
                                        x:Name="canvasScrollViewer"
                                        Grid.Row="0"
                                        CanContentScroll="True"
                                        Focusable="False"
                                        HorizontalScrollBarVisibility="{Binding ShowScrollbars}"
                                        VerticalScrollBarVisibility="{Binding ShowScrollbars}">
                                        <my:AnnoCanvas x:Name="annoCanvas"/>
                                    </ScrollViewer>

                                </LayoutDocument>
                            </LayoutDocumentPane> 
                            <!-- Right: properties as anchorable -->
                            <LayoutAnchorablePane  DockWidth="300" > 
                                <LayoutAnchorable  Title="{l:Localize Properties}"
                                                  CanClose="False">
                                    <!-- Buildings panel extracted into BuildingView.xaml -->
                                    <my:PropertiesView Height="200"/>

                                </LayoutAnchorable>
                                <LayoutAnchorable Title="{l:Localize Properties}"
                                                  CanClose="False">
                                    <!-- Buildings panel extracted into BuildingView.xaml -->
                                    <my:BuildingView />

                                    </LayoutAnchorable> 
                            </LayoutAnchorablePane>
                        </LayoutPanel>
                    </LayoutRoot>
                </DockingManager>

                <StatusBar Grid.Row="1"
                           Grid.ColumnSpan="3"
                           Padding="0"
                           Margin="0,989,0,0"
                           Grid.RowSpan="2">
                    <StatusBarItem Content="{l:Localize StatusBarControls}"/>
                    <StatusBarItem Margin="10,0,0,0"
                                   Content="{Binding StatusMessage}"/>
                    <StatusBarItem
                        Margin="10,0,0,0"
                        HorizontalAlignment="Right"
                        Content="{Binding StatusMessageClipboard}"/>
                </StatusBar>
            </Grid>
        </xctk:BusyIndicator>
    </Grid>
</ui:FluentWindow>