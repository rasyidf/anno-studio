<Page
    x:Class="AnnoDesigner.PreferencesPages.UpdateSettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:coreConverters="clr-namespace:AnnoDesigner.Core.Converters;assembly=AnnoDesigner.Core"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:l="clr-namespace:AnnoDesigner.Localization"
    xmlns:local="clr-namespace:AnnoDesigner.PreferencesPages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:viewModels="clr-namespace:AnnoDesigner.ViewModels"
    xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
    d:DataContext="{d:DesignInstance Type=viewModels:UpdateSettingsViewModel,
                                     IsDesignTimeCreatable=False}"
    d:DesignHeight="545.861"
    d:DesignWidth="800"
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    mc:Ignorable="d">
    <Page.Resources>
        <coreConverters:BoolToVisibilityConverter
            x:Key="converterBoolToVisibilityCollapsed"
            FalseValue="Collapsed"
            TrueValue="Visible" />
    </Page.Resources>
    <xctk:BusyIndicator BusyContent="{Binding BusyContent}" IsBusy="{Binding IsBusy}">

        <StackPanel Orientation="Vertical">

            <!--  Top: Version summary with action  -->
            <ui:CardExpander ContentPadding="0" IsExpanded="True">
                <ui:CardExpander.Header>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0" Orientation="Horizontal">
                            <ui:SymbolIcon
                                Width="36"
                                Height="36"
                                VerticalAlignment="Top"
                                Symbol="ArrowSync20" />
                            <StackPanel Margin="8,0,0,0">
                                <TextBlock
                                    FontSize="14"
                                    FontWeight="SemiBold"
                                    Text="{Binding VersionValue}" />
                                <TextBlock FontSize="12" Foreground="{DynamicResource TextFillColorSecondaryBrush}">
                                    <Run Text="{l:Localize UpdatePreferencesLastChecked, Mode=OneWay}" />
                                    <!--  If you have a last-checked property, bind it here  -->
                                    <Run Text=" " />
                                    <Hyperlink Command="{Binding OpenReleasesCommand}">{l:Localize UpdatePreferencesReleaseNotes}</Hyperlink>
                                </TextBlock>
                            </StackPanel>
                        </StackPanel>

                        <StackPanel
                            Grid.Column="1"
                            Margin="0,0,8,0"
                            VerticalAlignment="Center"
                            Orientation="Horizontal">
                            <Button Command="{Binding CheckForUpdatesCommand}" Content="{l:Localize CheckForUpdates}" />
                            <Button
                                Margin="10,0"
                                Command="{Binding DownloadPresetsCommand}"
                                Content="{l:Localize UpdatePreferencesDownloadPresetsAndRestart}"
                                Visibility="{Binding IsPresetUpdateAvailable, Converter={StaticResource converterBoolToVisibilityCollapsed}}" />
                        </StackPanel>
                    </Grid>
                </ui:CardExpander.Header>
                <StackPanel>
                    <ui:CardControl Padding="12">
                        <ui:CardControl.Header>
                            <CheckBox Content="{l:Localize EnableAutomaticUpdateCheck}" IsChecked="{Binding AutomaticUpdateCheck}" />
                        </ui:CardControl.Header>
                    </ui:CardControl>
                    <ui:CardControl Padding="12">
                        <ui:CardControl.Header>
                            <CheckBox Content="{l:Localize UpdatePreferencesCheckPreRelease}" IsChecked="{Binding UpdateSupportsPrerelease}" />
                        </ui:CardControl.Header>
                    </ui:CardControl>
                    <ui:CardControl Padding="12">
                        <ui:CardControl.Header>
                            <CheckBox Content="{l:Localize ShowMultipleInstanceWarning}" IsChecked="{Binding ShowMultipleInstanceWarning}" />
                        </ui:CardControl.Header>
                    </ui:CardControl>
                </StackPanel>
            </ui:CardExpander>


            <StackPanel>

                <ui:InfoBar
                    Title="{l:Localize UpdatePreferencesNoUpdates}"
                    Margin="0,6,0,0"
                    IsOpen="{Binding IsAppUpToDate}"
                    Severity="Success" />

                <ui:InfoBar
                    Title="{l:Localize UpdatePreferencesErrorCheckingUpdates}"
                    Margin="0,6,0,0"
                    IsOpen="{Binding IsUpdateError}"
                    Severity="Error">
                    <TextBlock Text="{l:Localize UpdatePreferencesMoreInfoInLog}" TextWrapping="Wrap" />
                </ui:InfoBar>

                <ui:InfoBar
                    Title="{l:Localize UpdatePreferencesNewAppUpdateAvailable}"
                    Margin="0,6,0,0"
                    IsOpen="{Binding IsUpdateAvailable}"
                    Severity="Warning">
                    <TextBlock>
                        <Hyperlink Command="{Binding OpenReleasesCommand}">https://github.com/AnnoDesigner/anno-designer/releases</Hyperlink>
                    </TextBlock>
                </ui:InfoBar>

                <ui:InfoBar
                    Title="{l:Localize UpdatePreferencesNewPresetsUpdateAvailable}"
                    Margin="0,6,0,0"
                    IsOpen="{Binding IsPresetUpdateAvailable}"
                    Severity="Warning" />
            </StackPanel>
            <!--  Detailed version info moved to bottom  -->
            <ui:CardExpander Margin="0,10,0,0" IsExpanded="True">
                <ui:CardExpander.Header>
                    <TextBlock Text="{l:Localize UpdatePreferencesVersionInformation}" />
                </ui:CardExpander.Header>
                <StackPanel Margin="10,6,0,0" Grid.IsSharedSizeScope="True">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="200" SharedSizeGroup="LocalizationColumn" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="{l:Localize Version, StringFormat='\{0\}:', Mode=OneWay}" />
                        <TextBlock Grid.Column="1" Text="{Binding VersionValue}" />
                    </Grid>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition SharedSizeGroup="LocalizationColumn" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="{l:Localize PresetsVersion, StringFormat='\{0\}:', Mode=OneWay}" />
                        <TextBlock Grid.Column="1" Text="{Binding PresetsVersionValue}" />
                    </Grid>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition SharedSizeGroup="LocalizationColumn" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="{l:Localize ColorPresetsVersion, StringFormat='\{0\}:', Mode=OneWay}" />
                        <TextBlock Grid.Column="1" Text="{Binding ColorPresetsVersionValue}" />
                    </Grid>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition SharedSizeGroup="LocalizationColumn" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="{l:Localize TreeLocalizationVersion, StringFormat='\{0\}:', Mode=OneWay}" />
                        <TextBlock Grid.Column="1" Text="{Binding TreeLocalizationVersionValue}" />
                    </Grid>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition SharedSizeGroup="LocalizationColumn" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="{l:Localize FileVersion, StringFormat='\{0\}:', Mode=OneWay}" />
                        <TextBlock Grid.Column="1" Text="{Binding FileVersionValue}" />
                    </Grid>
                </StackPanel>
            </ui:CardExpander>

        </StackPanel>

    </xctk:BusyIndicator>
</Page>
